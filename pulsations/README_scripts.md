# Pulsation Mode Analysis Scripts

This directory contains scripts for probing and visualizing stellar pulsation modes and their effects on spectral lines.

## Scripts

### 1. `probe_pulsation_modes.py`

Generates synthetic spectra for different pulsation modes over a full pulsation period.

**Usage:**
```bash
python probe_pulsation_modes.py [options]
```

**Key Options:**
- `--modes`: Comma-separated l,m pairs (e.g., "2,6;3,4;4,3")
- `--amplitude`: Pulsation amplitude (default: 1e-3)
- `--n-faces`: Mesh resolution (default: 20000)
- `--n-times`: Number of time steps (default: 20)
- `--period`: Period to sample over (default: 2.0)
- `--output`: Output pickle file (default: pulsations/pulsation_mode_data.pkl)

**Example:**
```bash
# Probe three different modes
python probe_pulsation_modes.py --modes "2,6;3,4;4,3" --amplitude 1e-3 --n-times 30

# Quick test with lower resolution
python probe_pulsation_modes.py --modes "2,6" --n-faces 5000 --n-times 10
```

### 2. `visualize_pulsation_modes.py`

Visualizes the data generated by `probe_pulsation_modes.py`.

**Usage:**
```bash
python visualize_pulsation_modes.py input_file [options]
```

**Key Options:**
- `input`: Path to the pickle file from probe_pulsation_modes.py (required)
- `--output-dir`: Directory to save plots (if not specified, shows interactively)
- `--plots`: Which plots to generate (choices: all, comparison, evolution, zoom)
- `--zoom-min`, `--zoom-max`: Wavelength range for zoom plot

**Example:**
```bash
# Show plots interactively
python visualize_pulsation_modes.py pulsations/pulsation_mode_data.pkl

# Save plots to directory
python visualize_pulsation_modes.py pulsations/pulsation_mode_data.pkl --output-dir pulsations/plots

# Generate only specific plots
python visualize_pulsation_modes.py pulsations/pulsation_mode_data.pkl --plots comparison zoom
```

## Complete Workflow

```bash
# 1. Generate the data (this may take several minutes)
python pulsations/probe_pulsation_modes.py \
    --modes "2,6;3,4;4,3;5,2" \
    --amplitude 1e-3 \
    --n-times 30 \
    --n-faces 20000 \
    --output pulsations/pulsation_data.pkl

# 2. Visualize the results
python pulsations/visualize_pulsation_modes.py \
    pulsations/pulsation_data.pkl \
    --output-dir pulsations/figures
```

## Output Data Format

The pickle file contains a dictionary with:
- `modes`: List of (l, m) tuples
- `amplitude`: Pulsation amplitude
- `timestamps`: Array of time points
- `phases`: Normalized phases (0 to 1)
- `wavelengths`: Wavelength array in linear space (Å)
- `wavelengths_log`: Wavelength array in log10 space
- `spectra_by_mode`: Dictionary keyed by (l, m) tuples containing:
  - `raw_spectra`: Raw flux data (shape: n_times × n_wavelengths × 2)
  - `normalized`: Normalized spectra (shape: n_times × n_wavelengths)

## Loading Data in Python

```python
import pickle
import numpy as np
import matplotlib.pyplot as plt

# Load the data
with open('pulsations/pulsation_mode_data.pkl', 'rb') as f:
    data = pickle.load(f)

# Access specific mode
l, m = 2, 6
spectra = data['spectra_by_mode'][(l, m)]['normalized']
wavelengths = data['wavelengths']
phases = data['phases']

# Plot
plt.figure(figsize=(10, 6))
for spec, phase in zip(spectra, phases):
    plt.plot(wavelengths, spec, alpha=0.5, label=f'φ={phase:.2f}')
plt.xlabel('Wavelength (Å)')
plt.ylabel('Normalized Flux')
plt.title(f'Mode l={l}, m={m}')
plt.show()
```

## Performance Notes

- Computation time scales roughly with `n_faces × n_times × n_modes`
- Typical run with default settings (20000 faces, 20 time steps, 3 modes): ~10-15 minutes
- Lower resolution test (5000 faces, 10 time steps): ~1-2 minutes
- Output file size: typically 50-200 MB depending on resolution

## Physical Parameters

The pulsations are modeled as spherical harmonics Y_l^m with:
- **l**: Degree (number of nodal lines from pole to pole)
- **m**: Order (number of nodal lines around equator)
- **amplitude**: Fractional radius variation (typical: 1e-3 to 1e-2)

Common modes to explore:
- (2, 0): Radial-like
- (2, 2): Sectoral
- (3, 1): Tesseral
- (4, 4): High-order sectoral

